{% extends "vault/base.html" %}
{% block title %}QueryVault — Search{% endblock %}
{% block content %}
<form class="card mb-5" method="get">
  <div class="card-body grid md:grid-cols-[1fr_280px_160px_auto] gap-3">
    <input class="input" type="text" name="q" value="{{ q }}" placeholder="Түлхүүр үгээр хайх (title, description, SQL, tags)">
    <input class="input" type="text" name="tag" value="{{ tag }}" placeholder="tag: dev, sales, ...">
    <select class="select" name="db_type">
      <option value="">All DB</option>
      {% for val,label in snippets.model.DB_CHOICES %}
        <option value="{{ val }}" {% if val == dbt %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <button class="btn btn-primary" type="submit">Search</button>
  </div>
</form>

<div class="space-y-4">
  {% for s in snippets %}
  <article class="card">
    <div class="card-body">
      <div class="flex items-start justify-between gap-3">
        <div>
          <a href="{% url 'vault:snippet_detail' pk=s.id %}" class="text-blue-700 font-semibold hover:underline">{{ s.title }}</a>
          <div class="mt-1 flex items-center gap-3 text-sm text-slate-500">
            <span>{{ s.get_db_type_display }}</span>
            <span>Updated: {{ s.updated_at|date:"Y-m-d H:i" }}</span>
            {% if s.tags %}
              <span class="flex items-center gap-1">
                {% for t in s.tag_list %}<span class="chip">{{ t }}</span>{% endfor %}
              </span>
            {% endif %}
            <span>Used: {{ s.use_count }}</span>
          </div>
        </div>
      </div>
      {% if s.description %}<p class="mt-3 text-slate-700">{{ s.description|truncatechars:200 }}</p>{% endif %}
    </div>
  </article>
  {% empty %}
    <div class="text-slate-600">No results.</div>
  {% endfor %}
</div>
{% endblock %}
